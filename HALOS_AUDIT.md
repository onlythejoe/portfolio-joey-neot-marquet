# Audit Halos — EA Lite (analyse uniquement)

- **Structure DOM** : `body` (fond noir via `--ea-bg`) → `#ea-root` → slots (`#ea-head-slot`, `#ea-body-start-slot`, `#ea-menu-slot`) → `#ea-layout` (grille 5% + 1fr) avec `#ea-progress-nav` (aside) + `#ea-page-content.ea-scroll` (main scrollable) → footer/`#ea-body-end-slot`. Aucun wrapper entre le fond body et `#ea-layout` : l’emplacement idéal pour une couche halos est un conteneur fixe inséré dans `#ea-root`, juste après `#ea-body-start-slot` et avant `#ea-layout` pour rester sous l’UX.
- **Layers / z-index** : menu fixe `z-index:1000` (assets/css/master/menu.master.css), skip-link `z-index:2000` (ea.master.css). Le reste (sections, progress-nav) n’a pas de z-index explicite → halo-layer peut vivre sous `#ea-layout` avec `z-index` faible (ex : 0/1) + `pointer-events:none`. Progress-nav a `pointer-events:none` → aucune interaction à préserver.
- **Scroll & modes** : `#ea-page-content` est le conteneur scroll principal (`height:100vh`, `scroll-snap-type:y mandatory`, `scroll-behavior:smooth`). En mode détail, `body` reçoit `.ea-mode-detail` et `#ea-page-content` `.ea-content--detail` (assets/css/master/sections.master.css) : scroll-snap désactivé, layout passe en 1 colonne, progress-nav masqué. Les halos devront rester stables entre ces modes pour éviter tout “jump”.
- **Routing / lifecycle** : `loader.js` résout `?page`/`?section`, compose la page, puis dispatch `ea-page-loaded` (EVENTS.pageLoaded) + `ea-analytics`. `popstate` relance le loader. `composePage` construit les sections d’après `config/pages.json` et applique l’état preview/détail via `createSectionController`.
- **Changement preview → detail** : clic sur `[data-section-trigger="open"]` appelle `updateUrl(page, section)` (pushState) et `applySectionState(target)` ; retour via `[data-section-trigger="back"]`. Aucun event dédié n’est émis : pour les halos, il faudra soit écouter ces triggers, soit observer le changement de classe `.ea-content--detail`/`.ea-mode-detail`.
- **CSS cascade / contraintes** : tokens centralisés (assets/css/tokens/ea.tokens.css), surfaces déjà semi-transparentes ; pages CSS vides (home/about/…) donc pas de collision couleur actuelle. `prefers-reduced-motion: reduce` désactive scroll-snap/animations critiques. Le halo-system devra respecter PRM et conserver `pointer-events:none` pour ne pas gêner la scroll-zone.
- **Slots & partials** : les partials globaux sont injectés dans les slots via `composer-global.js` avant la composition de page. Aucun hook visuel entre `#ea-body-start-slot` et `#ea-layout` → fenêtre naturelle pour une couche graphique globale (halo canvas/div).

